<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        #box{
            position: relative;
            margin: 0 auto;
            top: 20px;
            width: 1000px;
            height: 600px;
            background-color: #eee;
        }
        table{
            position: relative;
            margin: 0 auto;
            border: 2px solid rgba(200, 200, 200, .5);
        }
        tr,td{
            background-color: #aaa;
        }
        td{
            width: 18px;
            height: 18px;
            border: 1px solid #fff;
        }
        .snake{
            background-color: #000;
        }
        .food{
            background-color: green;
        }
    </style>
</head>
<body>
    <div id="box">
        <title>Snake</title>
    </div>
    
    <script>
        function Map(w,h){
            this.wnum=w;
            this.hnum=h;
            this.per=8;
            this.trs=[];
            this.dom=null;

            this.init();
        }
        Map.prototype={
            init:function(){
                //地图加载
                this.dom=document.createElement("table");
                box.appendChild(this.dom);
                for(var i=0;i<this.hnum;i++){
                    var tr=document.createElement("tr");
                    var tds=[];
                    for(var j=0;j<this.wnum;j++){
                        var td=document.createElement("td");
                        tds.push(td);
                        tr.appendChild(td);
                    }
                    this.trs.push(tds);
                    this.dom.appendChild(tr);
                } 
            }
            ,middle:function(){
                //使整个地图在box中水平居中、垂直居中
            }
            ,render:function(){
                //地图渲染
            }
        }
        
        function Snake(map,food){
            this.body=[];
            this.timer=null;
            this.map=map;
            this.food=food;

            this.init();
            this.render(this.map);
            this.moveIt();
            var self=this;
            // this.timer=setInterval(this.moveIt,100);
        }
        Snake.prototype={
            init:function(){
                //初值刷新
                this.body=[{x:1,y:1},{x:2,y:1},{x:3,y:1}];

            }
            ,moveIt:function(){
                //遍历身体，并改变身体，往前一步（默认继续上一个方向）
                // this.refresh(this.map);
                this.body.unshift(this.controlToNew());
                for(var i=0;i<this.food.list.length;i++){
                    if((this.body[0].x===this.food.list[i].x)&&(this.body[0].y===this.food.list[i].y)){
                        this.food.list[i]={};
                        this.render(this.map);
                        return;
                    }
                }
                this.body.pop();
                this.render(this.map);
            }
            ,controlToNew:function(){
                //根据键盘输入改变下一步的方向
                var self=this;
                var json={x:this.body[0].x,y:this.body[0].y};
                var temp={dx:this.body[1].x-this.body[0].x,dy:this.body[1].y-this.body[0].y};
                document.onkeydown=function(event){
                    event=event||window.event;
                    switch(event.keyCode){
                        case 37:
                        temp.dx=-1;
                        break;
                        case 38:
                        temp.dy=-1;
                        break;
                        case 39:
                        temp.dx=1;
                        break;
                        case 40:
                        temp.dy=1;
                        break;
                        default:
                        break;
                    }    
                }
                json.x+=temp.dx;
                json.y+=temp.dy;
                return json;
            }
            ,render:function(map){
                //将身体渲染到地图上

                for(var i=0;i<this.body.length;i++){
                    map.trs[this.body[i].y][this.body[i].x].className="snake";
                }
            }
            ,refresh:function(map){
                for(var i=0;i<this.body.length;i++){
                    map.trs[this.body[i].y][this.body[i].x].className="";
                }
            }
        }

        function Food(x,y,amount,map){
            this.x=x;
            this.y=y;
            this.weight=1;
            this.color="green"
            this.map=map;
            this.amount=amount;
            this.list=[];

            // this.prototype.render=snake.render;

            this.init();
            this.render(map);
        }
        Food.prototype={
            init:function(){
                //生成
                this.list=[];
                for(var i=0;i<this.amount;i++){
                    var temp=this.randomIt();
                    console.log(temp);
                    this.list.push(temp);
                }
            }
            ,randomIt:function(){
                //单个随机生成
                var xtemp=parseInt(Math.random()*this.x);
                var ytemp=parseInt(Math.random()*this.y);
                var temp={x:xtemp,y:ytemp};
                return temp;
            }
            ,render:function(){
                for(var i=0;i<this.list.length;i++){
                    this.map.trs[this.list[i].y][this.list[i].x].className="food";
                }
            }
        }

        function Game(w,h,s,acount){
            this.width=w;
            this.height=h;
            this.speed=s;
            this.acount=acount;
            this.score=0;
            this.timer=null;

            var m= new Map(40,20);
            var f= new Food(40,20,10,m)
            var s= new Snake(m,f);
        }
        Game.prototype={

        }

        new Game();
    </script>
</body>
</html>